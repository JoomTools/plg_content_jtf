/**
 * @package      Joomla.Plugin
 * @subpackage   Content.Jtf
 *
 * @author       Guido De Gobbis <support@joomtools.de>
 * @copyright    (c) 2019 JoomTools.de - All rights reserved.
 * @license      GNU General Public License version 3 or later
 **/
domIsReady(()=>{let e=(e,t)=>{let r="",i="";const a=e.querySelector(".dragarea"),l=e.querySelector(".allowedExt"),n=document.querySelector("#"+t.id),o=e.querySelector(".upload-list"),d=document.querySelector('label[for="'+t.id+'"'),s=n.getAttribute("accept").split(","),u=t.uploadMaxSize,c=Joomla.JText._("JTF_UPLOAD_ALLOWED_FILES_EXT",""),p=Joomla.JText._("JTF_UPLOAD_ERROR_MESSAGE_SIZE",""),g=Joomla.JText._("JTF_UPLOAD_ERROR_FILE_NOT_ALLOWED","");for(let e=0,t="";e<s.length;++e){let a=mimelite.getType(s[e].replace(".","")),l=mimelite.getExtension(s[e].replace(".",""));null===a&&(a=mimelite.getTypes(s[e].replace(".",""))),null===l&&(l=s[e].replace(".","")),null!==l&&(i+=(t=i?",":"")+l,"zip"===l&&(r+=t+"application/x-zip-compressed")),null!==a&&(r+=(t=r?",":"")+a)}function v(e){if(e){if(new RegExp(e).test(r))return!0}return!1}function m(e,t){let r=t?1e3:1024;if(Math.abs(e)<r)return e+" B";let i=t?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],a=-1;do{e/=r,++a}while(Math.abs(e)>=r&&a<i.length-1);return e.toFixed(1)+" "+i[a]}function E(e){let t={},r=[],i="",l=function(e){let t=0;for(let r=0,i=e[r];r<e.length;r++)t+=i.size;return t}(t=void 0!==e.originalEvent?e.originalEvent.target.files:e.target.files);for(let e=0,a=t[e];e<t.length;e++)v(a.type)?r.push("<li><strong>Upload: ",a.name,"</strong> (",m(a.size,!0),")</li>"):i+="<p><strong>Error: "+a.name+"</strong> - "+g+"</p>";l>u&&(i+="<p><strong>Error: "+m(l,!0)+"</strong> - "+p+"</p>"),i?(d.classList.add("invalid"),d.setAttribute("aria-invalid",!0),a.classList.add("invalid"),a.setAttribute("aria-invalid",!0),n.classList.add("invalid"),n.setAttribute("aria-invalid",!0),document.formvalidator.setHandler("file",()=>!1)):(d.classList.remove("invalid"),d.setAttribute("aria-invalid",!1),a.classList.remove("invalid"),a.setAttribute("aria-invalid",!1),n.classList.remove("invalid"),n.setAttribute("aria-invalid",!1),document.formvalidator.setHandler("file",()=>!0)),o.innerHTML=i+'<ul style="text-align: left;">'+r.join("")+"</ul>"}i="."+i.replace(/,/g," ."),r=r.replace(/,/g," "),l.innerHTML=c+i,void 0!==n&&(n.addEventListener("drag dragstart dragend dragover dragenter dragleave change",e=>{e.preventDefault(),e.stopPropagation()}),n.addEventListener("dragenter dragover",e=>{a.classList.add("hover")}),n.addEventListener("dragleave dragend drop",e=>{a.classList.remove("hover")}),n.addEventListener("change",e=>{E(e)}))},t=document.querySelectorAll(".uploader-wrapper");Array.prototype.forEach.call(t,function(t){e(t,{id:t.querySelector('.legacy-uploader input[type="file"]').getAttribute("id"),uploadMaxSize:t.querySelector('.legacy-uploader input[type="hidden"]').getAttribute("value")})})});