jQuery(document).ready(function($){$.fn.jtfUploadFile=function(optionlist){for(var $dragZone=this.find(".dragarea"),$allowedExt=this.find(".allowedExt"),$fileInput=$("#"+optionlist.id),$uploadList=this.find(".upload-list"),$label=$('label[for="'+optionlist.id+'"'),accept=$fileInput.attr("accept").split(","),maxsize=optionlist.uploadMaxSize,msgAllowedExt=Joomla.JText._("JTF_UPLOAD_ALLOWED_FILES_EXT",""),errorFileSize=Joomla.JText._("JTF_UPLOAD_ERROR_MESSAGE_SIZE",""),errorFileType=Joomla.JText._("JTF_UPLOAD_ERROR_FILE_NOT_ALLOWED",""),i=0,acceptedType="",acceptedExt="";i<accept.length;++i){var mimeType=mimelite.getType(accept[i].replace(".","")),fileExt=mimelite.getExtension(accept[i].replace(".",""));null===mimeType&&(mimeType=mimelite.getTypes(accept[i].replace(".",""))),null===fileExt&&(fileExt=accept[i].replace(".","")),null!==fileExt&&(acceptedExt+=(acceptedExt?",":"")+fileExt),null!==mimeType&&(acceptedType+=(acceptedType?",":"")+mimeType)}function allowedFile(fileType){if(fileType&&new RegExp(fileType).test(acceptedType))return!0;return!1}function humanReadableSize(bytes,si){var thresh=si?1e3:1024;if(Math.abs(bytes)<thresh)return bytes+" B";for(var units=si?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],u=-1;bytes/=thresh,++u,Math.abs(bytes)>=thresh&&u<units.length-1;);return bytes.toFixed(1)+" "+units[u]}function dateiauswahl(files){for(var f,output=[],uploadError="",uploadsize=function(files){for(var f,size=0,i=0;f=files[i];i++)size+=f.size;return size}(files),i=0;f=files[i];i++)allowedFile(f.type)?output.push("<li><strong>Upload: ",f.name,"</strong> (",humanReadableSize(f.size,!0),")</li>"):uploadError+="<p><strong>Error: "+f.name+"</strong> - "+errorFileType+"</p>";maxsize<uploadsize&&(uploadError+="<p><strong>Error: "+humanReadableSize(uploadsize,!0)+"</strong> - "+errorFileSize+"</p>"),uploadError?($label.addClass("invalid").attr("aria-invalid",!0),$dragZone.addClass("invalid").attr("aria-invalid",!0),$fileInput.addClass("invalid").attr("aria-invalid",!0),document.formvalidator.setHandler("file",function(){return!1})):($label.removeClass("invalid").attr("aria-invalid",!1),$dragZone.removeClass("invalid").attr("aria-invalid",!1),$fileInput.removeClass("invalid").attr("aria-invalid",!1),document.formvalidator.setHandler("file",function(){return!0})),$uploadList.html(uploadError+'<ul style="text-align: left;">'+output.join("")+"</ul>")}acceptedExt=acceptedExt.replace(/,/g," ."),acceptedType=acceptedType.replace(/,/g," "),$allowedExt.html(msgAllowedExt+acceptedExt),$fileInput.on("drag dragstart dragend dragover dragenter dragleave change",function(e){e.preventDefault(),e.stopPropagation()}).on("dragenter dragover",function(e){$dragZone.addClass("hover")}).on("dragleave dragend drop",function(e){$dragZone.removeClass("hover")}).on("change",function(e){dateiauswahl(e.originalEvent.target.files)})},$(".uploader-wrapper").each(function(){$(this).jtfUploadFile({id:$(this).find('.legacy-uploader input[type="file"]').attr("id"),uploadMaxSize:$(this).find('.legacy-uploader input[type="hidden"]').attr("value")})})});