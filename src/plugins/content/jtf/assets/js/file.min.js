/**
 * @package      Joomla.Plugin
 * @subpackage   Content.Jtf
 *
 * @author       Guido De Gobbis <support@joomtools.de>
 * @copyright    (c) 2017 JoomTools.de - All rights reserved.
 * @license      GNU General Public License version 3 or later
 **/
jQuery(document).ready(function(a){a.fn.jtfUploadFile=function(e){for(var t=this.find(".dragarea"),i=this.find(".allowedExt"),r=a("#"+e.id),n=this.find(".upload-list"),l=a('label[for="'+e.id+'"'),o=r.attr("accept").split(","),d=e.uploadMaxSize,s=Joomla.JText._("JTF_UPLOAD_ALLOWED_FILES_EXT",""),u=Joomla.JText._("JTF_UPLOAD_ERROR_MESSAGE_SIZE",""),p=Joomla.JText._("JTF_UPLOAD_ERROR_FILE_NOT_ALLOWED",""),f=0,g="",v="";f<o.length;++f){var c=mimelite.getType(o[f].replace(".","")),m=mimelite.getExtension(o[f].replace(".",""));null===c&&(c=mimelite.getTypes(o[f].replace(".",""))),null===m&&(m=o[f].replace(".","")),null!==m&&(v+=(v?",":"")+m),null!==c&&(g+=(g?",":"")+c)}function h(a){if(a&&new RegExp(a).test(g))return!0;return!1}function E(a,e){var t=e?1e3:1024;if(Math.abs(a)<t)return a+" B";var i=e?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],r=-1;do{a/=t,++r}while(Math.abs(a)>=t&&r<i.length-1);return a.toFixed(1)+" "+i[r]}function B(a){for(var e,i=[],o="",s=function(a){for(var e,t=0,i=0;e=a[i];i++)t+=e.size;return t}(a),f=0;e=a[f];f++)h(e.type)?i.push("<li><strong>Upload: ",e.name,"</strong> (",E(e.size,!0),")</li>"):o+="<p><strong>Error: "+e.name+"</strong> - "+p+"</p>";s>d&&(o+="<p><strong>Error: "+E(s,!0)+"</strong> - "+u+"</p>"),o?(l.addClass("invalid").attr("aria-invalid",!0),t.addClass("invalid").attr("aria-invalid",!0),r.addClass("invalid").attr("aria-invalid",!0),document.formvalidator.setHandler("file",function(){return!1})):(l.removeClass("invalid").attr("aria-invalid",!1),t.removeClass("invalid").attr("aria-invalid",!1),r.removeClass("invalid").attr("aria-invalid",!1),document.formvalidator.setHandler("file",function(){return!0})),n.html(o+'<ul style="text-align: left;">'+i.join("")+"</ul>")}v=v.replace(/,/g," ."),g=g.replace(/,/g," "),i.html(s+v),r.on("drag dragstart dragend dragover dragenter dragleave change",function(a){a.preventDefault(),a.stopPropagation()}).on("dragenter dragover",function(a){t.addClass("hover")}).on("dragleave dragend drop",function(a){t.removeClass("hover")}).on("change",function(a){B(a.originalEvent.target.files)})},a(".uploader-wrapper").each(function(){a(this).jtfUploadFile({id:a(this).find('.legacy-uploader input[type="file"]').attr("id"),uploadMaxSize:a(this).find('.legacy-uploader input[type="hidden"]').attr("value")})})});